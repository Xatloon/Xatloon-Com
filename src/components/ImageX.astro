---
import type { ImageMetadata } from 'astro'

import { getImage } from 'astro:assets'

interface Props {
  alt: string
  class?: string
  height?: number
  ref?: {
    text: string
    url: string
  }
  src: ImageMetadata | string
  width?: number
}

const { src, alt, ref, width, height, class: className } = Astro.props

const image = await getImage({
  src,
  width,
  height,
  quality: 75,
  format: 'webp',
  sizes: '100vw',
})

---

<figure class="relative">
  <img
    alt={alt}
    class={className}
    decoding="async"
    loading="lazy"
    src={image.src}
  />
  {ref && (
    <figcaption class="absolute bottom-1 flex items-center justify-center text-sm text-gray-500">
      <a
        href={ref.url}
        rel="noopener noreferrer"
        target="_blank"
      >
        {ref.text}
      </a>
    </figcaption>
  )}
</figure>
